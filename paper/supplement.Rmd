## The NMFâ€“Cox model shows consistent convergence and stability across restarts

Across datasets and initialization schemes, the NMFâ€“Cox algorithm consistently converged to numerically stable solutions within the designated iteration budget. Warm-start strategies, in which solutions at $\alpha=0$ initialized supervised runs, substantially reduced variability across restarts and improved reproducibility. Figure \@ref(fig:fig-converge) shows representative loss trajectories demonstrating monotone decreases until convergence across restarts. Compared with naÃ¯ve random initialization, warm-starts produced tighter distributions of cross-validated C-index and partial likelihood, confirming stability of the optimization procedure.

```{r fig-converge, fig.width = 6, fig.height= 4, fig.cap="Convergence of model for k=8 alpha=.5" , fig.env='figure*', fig.pos='t', out.height= "4in", out.width='\\textwidth'}
tar_load(full_model)
runs=readRDS(full_model)
# iter_cold = 

iters = list()
for(i in 1:5){
  lossit = runs[[i]]$fits[[as.character(0.5)]]$lossit
  lossit = data.frame(lossit=lossit,iter=1:length(lossit))
  lossit$init=i
  iters[[i]] = lossit
}

lossit=dplyr::bind_rows(iters) %>% filter(iter<5000)

ggplot(lossit,aes(y=lossit,x=iter,color=as.factor(init)))+
  geom_line(linewidth=.8)+
  theme_minimal()+
  labs(x="Iteration",y="Loss",color="Initialization")

```


## Analysis of scRNA-seq {.unnumbered}
Next, we verify our findings at the cellular level using the Elyada scRNA-seq data [@elyada2019cross]. We found that our DeSurv factor 1 signature was expressed primarily in iCAF and B cells, factor 2 was expressed in Acinar and Classical PDAC 2, and factor 3 was expressed primarily in Basal-like PDAC cells (Figure \@ref(fig:fig-sc)B-E). This is consistent with our ORA analysis which found that factor 1 was mostly immune and factor 3 was basal-like, and with the overlap we saw with published gene lists that identified factor 1 as iCAF/classical/immune and factor 3 as basal-like. Interestingly, we do not see a large overlap of factor 1 with the classical PDAC cell types despite some overlap with classical gene lists. Need more here...

```{r fig-sc, fig.cap="A. Cell type clusters from the Elyada scRNA-seq data. B-D. VAM scores for the DeSurv factor signatures in each cell shown on the UMAP of cells in the Elyada-sc data. E. Heatmap of average VAM scores by cell type and factor signature in the Elyada-sc data.", fig.env='figure*', fig.pos='t', out.height= "8in", out.width='\\textwidth'}

fig_sc_plot <- tar_read_raw(resolve_target_name(
  "fig_sc_plot",
  bo_label = bo_label,
  run_label = run_label,
  available = available_targets
))
fig_sc_plot
```

